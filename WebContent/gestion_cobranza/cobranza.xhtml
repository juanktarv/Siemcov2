<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="/WEB-INF/plantillas/plantilla.xhtml">
	<ui:define name="contenido">
	
		<p:panel>
			
			<h:form>
				<p:breadCrumb>  
    				<p:menuitem value="Home" url="#" />  
    				<p:menuitem value="Cobranza" url="#" />
    				<p:menuitem value="Gestion de Cobranza" url="cobranza" />   
				</p:breadCrumb>	
			</h:form>
			
			
			<br/>
			<!-- growl general -->			
			<p:messages  id="msgGeneral" showDetail="false" showSummary="true" closable="true" />		
			
			<!-- tootlbar -->
			<h:form style="margin-bottom: 8px"> 				
				<p:panel >				
					<h:panelGroup columns="6">	
						<h:panelGrid columns="6" cellpadding="10">
							#{"Periodo:"}						 
								<p:selectOneMenu style="width:120px"
									value="#{cobranzaMB.mes}">
									<f:selectItem  itemLabel="Enero" itemValue="01" />
									<f:selectItem  itemLabel="Febrero" itemValue="02" />
									<f:selectItem  itemLabel="Marzo" itemValue="03" />
									<f:selectItem  itemLabel="Abril" itemValue="04" />
									<f:selectItem  itemLabel="Mayo" itemValue="05" />
									<f:selectItem  itemLabel="Junio" itemValue="06" />
									<f:selectItem  itemLabel="Julio" itemValue="07" />
									<f:selectItem  itemLabel="Agosto" itemValue="08" />
									<f:selectItem  itemLabel="Setiembre" itemValue="09" />
									<f:selectItem  itemLabel="Octubre" itemValue="10" />
									<f:selectItem  itemLabel="Noviembre" itemValue="11" />
									<f:selectItem  itemLabel="Diciembre" itemValue="12" />
								</p:selectOneMenu>
								<p:selectOneMenu style="width:100px"
									value="#{cobranzaMB.anio}">
									<f:selectItem  itemLabel="2014" itemValue="2014" />
									<f:selectItem  itemLabel="2015" itemValue="2015" />
									<f:selectItem  itemLabel="2016" itemValue="2016" />
									<f:selectItem  itemLabel="2017" itemValue="2017" />
									<f:selectItem  itemLabel="2018" itemValue="2018" />
									<f:selectItem  itemLabel="2019" itemValue="2019" />
									<f:selectItem  itemLabel="2020" itemValue="2020" />
								</p:selectOneMenu>
								
								#{"Tipo de Documento:"}					        
								<p:selectOneMenu style="width:400px" value="#{cobranzaMB.tipo_comprobante}"  >
									<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
									<f:selectItems value="#{cobranzaMB.listTablaTablasDetallesComprobante}" 
									var="p" itemLabel="#{p.descripcion_largo}" itemValue="#{p.codigo_catalogo}" />									
									<p:ajax event="itemSelect" listener="#{cobranzaMB.onItemDocumento}" update="buscarRespuesta"/>									
								</p:selectOneMenu>
								
								<h:panelGrid columns="2" id="buscarRespuesta">	
									<p:commandButton value="Buscar"  actionListener="#{cobranzaMB.listarMovimientosFiltros()}" disabled="#{cobranzaMB.disableBuscar}"
										update=":frmListaDocumentos :msgGeneral" icon="icon-search" 
										onstart="PF('BlockUIWidget').block();" oncomplete="PF('BlockUIWidget').unblock();"/>
								</h:panelGrid>
						</h:panelGrid>
					</h:panelGroup>
					<p:panelGrid>
						<h:outputLabel value="Cliente"></h:outputLabel>
						<p:autoComplete id="cliente" value="#{cobranzaMB.clienteEncontrado.nombre_cab}" 
										completeMethod="#{comprobanteMB.consultarCliente}"
	                        			var="cliente" 
	                        			itemLabel="#{cliente.nombre_cab}" 
	                        			itemValue="#{cliente.nombre_cab}" 
	                        			forceSelection="true"> 
	                        			                        
	                        <p:ajax event="itemSelect" 
	                        		listener="#{cobranzaMB.onItemCliente}" 
	                        		update="id_nombre"/>	                        
	                    </p:autoComplete>
	                    
	                     <p:outputLabel value="#{cobranzaMB.clienteEncontrado.desTipoDocumento}  
	                     					   #{cobranzaMB.clienteEncontrado.numero_docu_iden_cab}" 
	                     				id="id_nombre"
										style="width:200px ;font-size:15px; color:blue" />
								
						<h:outputLabel value="Nro Comprobante"></h:outputLabel>
						<h:inputText value="#{cobranzaMB.nroserie_documento}"></h:inputText>
						<p:commandButton value="Buscar" actionListener="#{cobranzaMB.buscarClienteComprobante()}"></p:commandButton>
					</p:panelGrid>
													
				</p:panel>
				
				
				
			</h:form>
			
			
			<h:form id="frmListaDocumentos">
					<pe:blockUI  widgetVar="BlockUIWidgetPage">        
				        <h:graphicImage library="resources/img" value="/resources/img/ajax-loader1.gif"  style="margin-right: 12px; vertical-align: middle;" />  
				        <h:outputText value="Cambiando de pÃ¡gina, espere por favor..." style="white-space: nowrap; font-weight:bold; color: #036fab"/> 
				    </pe:blockUI>
					<p:dataTable  var="p" value="#{cobranzaMB.listamovimientos}"  
						lazy="true" paginator="true" filteredValue="#{cobranzaMB.listaFiltroMovimientos}" 
						emptyMessage="No hay Comprobantes Disponibles." rowIndexVar="nro" style="FONT-SIZE: 10px;" id="dataTableComprobantes"
						rows="10" paginatorPosition="bottom"  rowsPerPageTemplate="10,100,200,500" widgetVar="dataTableComprobantes"
						paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  sortField="#{cgr.numero_serie_documento_cab}" sortOrder="DESCENDING">
						

						<p:blockUI block="dataTableComprobantes" trigger="dataTableComprobantes">
					        <h:graphicImage library="resources/img" value="/resources/img/ajax-loader1.gif"  
					        style="margin-right: 12px; vertical-align: middle;" />  
				        	<h:outputText value="Buscando, espere por favor..." 
				        		style="white-space: nowrap; font-weight:bold; color: #036fab"/>
					    </p:blockUI>
						<f:facet name="header">Lista de Comprobantes Emitidos</f:facet>
						<p:ajax event="page" onstart="PF('BlockUIWidgetPage').block();"  oncomplete="PF('BlockUIWidgetPage').unblock();"/>
						
						<p:column headerText="Orden" width="20" >
							#{nro+1}
						</p:column>		
						<p:column style="width:70px" headerText="Cliente">
							<h:outputText value="#{p.cliente.nombre_cab}"/>
						</p:column>
						<p:column style="width:70px" headerText="Nro Comprobante">
							<h:outputText value="#{p.nroserie_documento}"/>
						</p:column>
						<p:column style="width:70px" headerText="Importe">
							<h:outputText value="#{p.importe}"/>
						</p:column>
						<p:column style="width:70px" headerText="Saldo">
							<h:outputText value="#{p.saldopagado}"/>
						</p:column>
						<p:column style="width:70px" headerText="Estado">
							<h:outputText value="#{p.flag_regularizado}"/>
						</p:column>

						
				</p:dataTable>
			</h:form>
		</p:panel>
		
			
		
			
		
		
		<script>
			
			function validar(xhr, status, args) {
				if (args.validationFailed) {
					
				} else {
					PF('dlgNuevo').hide();
				}
			}
	
			function validarGuardar(xhr, status, args) {
				if (!args.esValido) {
					jQuery('#dlgDetNuevo').effect("shake", {
						times : 1
					}, 100);
				} else {
					
				}
			}
			
			function start() {
			    PF('statusDialog').show();
			}
			 
			function stop() {
			    PF('statusDialog').hide();
			}
		</script>
		
	</ui:define>
</ui:composition>
</html>